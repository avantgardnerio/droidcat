#!/bin/bash
(test $# -lt 0) && (echo "too few arguments") && exit 0
total=${1:-"2000"}
start=${2:-"1"}

szlimit=`expr 10 "*" 1024 "*" 1024`
checkapk()
{
	[[ $# -lt 1 ]] && return 0
	apk=$1
	sdk=$(gettargetsdk.sh "$apk")
	echo "target sdk="$sdk
	if [[ sdk -lt 0xa ]];then
		sdk=$(getminsdk.sh "$apk")
		echo "min sdk="$sdk
		[[ sdk -lt 0xa ]] && return 0
	fi
	size=$(stat -c%s "$apk")
	echo "size="$size
	[[ size -gt szlimit ]] && return 0 
	return 1
}

pc=$start
tgtdir=/home/hcai/testbed/selectedMalware/
mkdir -p $tgtdir
	ls /home/hcai/Malware_Apps_Apks/*.apk | while read fnapk
	do
		echo "===== try selecting app no. $pc $fnapk ====="
		checkapk "$fnapk"
		if [ $? -ne 1 ];then
			continue
		fi

		cp $fnapk $tgtdir
		(( pc ++ ))
		if [[ pc -ge total ]];then
			break
		fi
	done
exit 0

